\chapter{Conclusion}
\label{c:conclusion}

LC-MS based omics, such as proteomics and in particular metabolomics, play a major role in modern systems biology. However, there are many challenges in data pre-processing steps before LC-MS data can be analysed. In particular, the information from the peak grouping step is often not used in the alignment and identification stage. More broadly, the presence of a grouping structure means that a set of peaks can be structurally related. Generative models can be used to induce the clustering on the peak data, revealing the latent structures that exist. 

In this thesis, we have shown that using this structural information can help in alignment and identification. Our tools are generative modelling. Using this, we showed that grouping can be used to improve alignment (matching). In particular, we improve a direct matching method by by incorporating grouping information. IP clusters, corresponding to groups of peaks that are related through being the ionisation product peaks of the same metabolite, can also be matched directly -- either via a direct matching scheme or through a second-stage clustering method. A generative model also can be constructed that models all peaks across all files at once, producing alignment as a result and also useful latent structures. From fragmentation data, identification can be enhanced by taking into consideration the grouping of fragmentation peaks that potentially correspond to substructures.

\section{Summary of Contributions}

This thesis makes a number of contributions, motivated by our thesis statement in Section~\ref{sub:thesis-statement}, which is restarted in the following:

Untargeted liquid chromatography mass spectrometry data pre-processing is a challenging task that is often subjected to errors and inaccuracies. Much of this can be attributed to the complexity of the LC-MS data itself and also to the lack of knowledge as to which compounds are present in the sample. However, the structural dependencies in the observed peak data means that through generative modelling, we can explain the relationships between peaks, allowing us to produce groups of related peaks that can be used to improve or enhance the alignment and identification steps of LC-MS data pre-processing.

The thesis statement is then supported by the following contributions:

\begin{enumerate}

\item Chapter \ref{c:matching} presented a method to perform the grouping of related peaks by RT and combine this grouping information with a direct-matching method. We demonstrated on benchmark datasets with alignment ground truth how this information can be used to improve alignment. 

\item Chapter \ref{c:precursor-clustering} expands upon the grouping process in Chapter \ref{c:matching}, where only the RT information is used, and proposes a model that takes into consideration the mass information as well when grouping related peaks. Through a set of transformation rules (specific to metabolomics data at the moment), our model produces IP clusters, where member peaks can be explained by their ionisation product transformations. We showed in Chapter \ref{c:precursor-clustering} that IP clusters can be matched directly in place of peak features, and this produces an improved alignment performance. Additionally, uncertainties in the matching can also be quantified through a second-stage clustering of the IP clusters.

\item Chapter \ref{c:hdp} expands upon the work in Chapter \ref{c:precursor-clustering}. Instead of having to fix the MAP cluster assignment of peaks to local clusters in the same file, we introduce the notion of a hierarchical model that allows for peaks across multiple files to be grouped. We show that modelling the data generatively in this manner and performing grouping allows us to produce alignment (matching). From the model, highly confident matched peaksets can be extracted, which may be useful in some analytical cases.

\item Chapter \ref{c:lda} looks at fragmentation data, produced from tandem mass spectrometry process. We show that by thinking generatively, we can explain fragment peaks by how they relate to substructures shared by metabolites. This aids in exploratory data interpretation during the identification of compounds in metabolomics data. 

\end{enumerate}

\section{Future Work}

There are a number of interesting future work that could follow from the results in this thesis. They are:

\subsection{Improved Generative Models to Cluster Related Peaks}

Generative modelling of peaks are demonstrated in Chapters~\ref{c:matching} and \ref{c:precursor-clustering} where we build a model to cluster peaks in the same file by their RT values and explainable mass transformations. However, there is more information present in the LC-MS data that is not used in our model. In particular, peaks elute from liquid chromatography and produce chromatographic profiles (the retention time value of a peak is a point along the chromatographic profile). The chromatographic profiles of related peaks should be similar, and in \cite{Rogers2012}, a mixture model is proposed to cluster using chromatographic profiles. This is shown to produce improvements over the greedy approach of clustering peaks. We might also want to incorporate this information into our models, for example by changing the PrecursorCluster model from Chapter~\ref{c:precursor-clustering} and adding another likelihood term for the correlation of the chromatographic profiles. Following \cite{Rogers2012}, we might we use a two-component mixtures to describe this likelihood: the first component corresponds to the likelihood of peaks to be in the same cluster, while another component describes the likelihood of peaks to be in different clusters based on their chromatographic correlations. The proposed implementation in \cite{Rogers2012} uses Gibbs sampling, and we foresee that modifying our inference procedure to accommodate this new likelihood term to be straightforward.

The proposed PrecursorCluster model in Chapter~\ref{c:precursor-clustering} also makes a fairly strong assumption that the most intense peak in the cluster must be the $M+H$ peak. This assumption may not always hold as we have seen cases where valid clusters do not have its most intense peak as the $M+H$ peak. Relaxing this assumption means more clusters may be obtained, but depending on the data, we might also see more false assignments of peaks to clusters. Performing validations on the results with and without this constraint will be challenging and require a close collaboration with a life scientist who possesses the necessary expert knowledge to validate the data. This however might point to a more flexible method where peaks can be clustered without having to make such a strong assumption.

\subsection{Using the Generative Models for Identification}

The proposed models in this thesis are generally validated against the alignment ground truth, i.e. we consider that the models produce a sensible clustering of related peaks if we can take the resulting groups and use them to obtain a good alignment performance. However, that is not the only use of the output from the models. In particular, the set of related peaks that have been grouped together and can be explained as being generated from the same latent variable (corresponding to a compound) might be used for identification. We have explored a preliminary form of this idea in Section~\ref{c:precursor-clustering} where we hand-pick clusters that correspond to Cysteic acid and melatonin, and also in Section~\ref{c:hdp} where we take some global RT clusters and annotate them by their putative compound identities. Note that once we have assigned a putative compound identity to a clustering object, being able to annotate the entire peaks that are members of that cluster is a natural consequence of the clustering output of the model. It is worth investigating whether such an approach might bring an improved discriminative power to identification compared to identifying peaks one-by-one, as what is conventionally done at the moment. However, the lack of gold standard for identification means that this will be an extensive endeavour that again requires a close collaboration with a life scientist.

\subsection{Data Visualisation and Interpretation}

As the MS2LDAVis module in Chapter~\ref{c:lda} shows, the interpretation of complex inference results can be daunting to the average user. Having an easy-to-use visualisation interface that displays the most pertinent information in a user-friendly manner shifts this burden of interpretation from the user to the system, and it is important when producing tools that we hope will be used and adopted by the community at large. One of the problems with the probabilistic matching results returned by the Cluster-Cluster method in Chapter~\ref{c:precursor-clustering} and also the HDP-Align method in Chapter~\ref{c:hdp} is that the result does not lend itself to easy interpretation. The conventional way of presenting a list of aligned peaksets is in the form of a table, where each row corresponds to a consensus peak (derived from the aligned peakset) and the columns are the observed intensities in the different LC-MS runs. From our output, we now obtain aligned peaksets at varying probabilities, but how about other information that we obtain from inference? From the inferred clustering structures, we obtain more than just alignment as we can also extract for e.g. the inferred ionisation product types from PrecursorCluster, the entire top-level global RT cluster from the HDP model, etc.. Displaying this information in a manner that is useful to the user requires careful considerations. For instance, we might decide to supplement the usual tabular view of peaklist with a graphical visualisation showing how peaks are explained through which ionisation product transformations and their probabilities. Integration with external database services, such as PubChem \cite{bolton2008pubchem}, is also useful in this kind of visualisation systems to obtain additional meta-data that may enhance interpretation. 

\subsection{Topic Modelling of Fragmentation Data}

In our study, the multi-file LDA model proposed in Chapter~\ref{c:lda} is applied to a metabolomics dataset containing four beer LC-MS runs. However a larger dataset (up to 30 LC-MS runs) from a clinical experiment involving drug studies are available from our collaborators. This dataset has been run through the multi-file MS2LDA pipeline and can be used to validate that indeed we can find useful Mass2Motifs that correspond to substructures shared by drug metabolites. The proposed inference procedure in Chapter~\ref{c:lda} relies on Gibbs sampling, which has difficulties scaling to a large number of files, so we performed variational inference \cite{Blei2003} instead.

Our LDA models (both the single- and multi-file version) assumes that the number of Mass2-Motifs $K$ is known and has to be defined by the user or estimated through a cross-validation procedure (as what we have done in Chapter~\ref{c:lda}). Setting $K$ that is too large may lead to overfitting with many small, overly specific Mass2Motifs, while setting a value for $K$ that is too small leads to underfitting with large and generic Mass2Motifs. Hierarchical Dirichlet Process has been used as the prior in a non-parametric topic model \cite{teh2012hierarchical} and provides a principled mechanism to let the number of Mass2Motifs to be learned from the data. This can be implemented next. Along this line, we have also seen that Mass2Motifs form \emph{hierarchies}, with generic substructures, such as the loss of $CO$ that is shared by multiple Mass2Motifs. This suggest that a hierarchical extension of the LDA model can be considered to model the data \cite{griffiths2004hierarchical}. 

The problem of transferring Mass2Motifs that we have learned from one dataset to another is also something we need to consider as this will allow inferred and characterised Mass2Motifs to be stored in a database and applied to new, unseen data, allowing for rapid explorations of the unknowns . One way we can do this is by fixing the topic-to-word probabilities for the selected Mass2Motifs and using them when running LDA on the new data. This approach, however, is rather \textit{ad-hoc}, and more principled approach such as \cite{kang2012transfer} can be considered. For the transferring of Mass2Motifs to work, a common vocabular space over the words have to be defined on the existing data used for training and the new data. Rather than using the discretised fragment and loss features (as what we do now) that heavily depend on the mass accuracy of a particular instrument, we may explore alternative binning procedures that use the elemental formulae as the `words' in the LDA system . The MS2LDAVis module can also be extended to allow for Mass2Motifs expressions in the different files to be compared easily. All these are the necessary building blocks that contribute towards the development of an online interactive system that the community can use to submit validated topics and apply them new dataset for a rapid exploration of the `fragmentome' on new and unseen fragmentation data.

\section{Summary and Conclusions}

Data pre-processing is a challenging task in LC-MS preprocessing pipeline. In this thesis, we have shown how generative models can be used to explain the relationships between related peaks, allowing for groups of related peaks to be extracted. We have shown how starting from this premise, we could propose new methods that improve on alignment and enhance identification. In alignment, this is accomplished through the grouping of related peaks into ionisation product (IP) clusters, whether based on retention time (RT) alone or by considering the mass relationships between peaks as well. More accurate alignment can be constructed by taking into account this information on the IP clusters --- as opposed to the normal case of matching by peak features alone and not taking the structural dependencies of these peaks into account. Modelling LC-MS runs hierarchically also allows us to group IP peaks within and across runs at once, and while in this thesis, we use the results to produce a probabilistic matching of peaks, the inferred latent structures might be used for other steps in the data pre-processing pipeline as well. And finally, we look at fragmentation data and demonstrate that by modelling the structural dependencies of fragment peaks, we produce a method that aid in data interpretation and the characterisation of complex fragmentation spectra. The latter represents an active research that directly addresses the primary bottleneck of data pre-processing of metabolomics data in an untargeted manner.

Although there is a lot of work to be done still, we believe that the thesis presents a compelling case to the benefit of generative modelling of peak data. The structural information that is present in mass spectrometry data is often neglected in alignment and identification via fragmentation data. Our results show that this results in useful information that can be used to improve the quality of the preprocessing pipeline.